<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Блог - Лента постов</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background-color: #f0f2f5;
          margin: 20px;
        }

        h1 {
          font-size: 2em;
          margin-bottom: 20px;
        }

        .header-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .add-post-btn {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }

        .add-post-btn:hover {
            background-color: #218838;
        }

        .search-form {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-form input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }

        .search-form button {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-form button:hover {
            background-color: #0056b3;
        }

        .posts-container {
          display: flex;
          flex-wrap: wrap;
          gap: 20px;
        }

        .post {
          background-color: #fff;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          width: calc(33% - 20px);
          display: flex;
          flex-direction: column;
        }

        .post img {
          width: 100%;
          border-top-left-radius: 8px;
          border-top-right-radius: 8px;
        }

        .post-content {
          padding: 15px;
        }

        .post-title {
          font-weight: bold;
          margin-bottom: 10px;
          color: #007bff;
          text-decoration: none;
        }

        .post-title:hover {
          text-decoration: underline;
        }

        .post-text {
          font-size: 0.9em;
          color: #555;
        }

        .no-posts {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        .search-info {
            margin-bottom: 15px;
            color: #666;
            font-style: italic;
        }

        @media(max-width: 1024px) {
          .post {
            width: calc(50% - 20px);
          }
        }

        @media(max-width: 600px) {
          .post {
            width: 100%;
          }
          .header-buttons {
            flex-direction: column;
            gap: 10px;
          }
          .search-form {
            flex-direction: column;
          }
        }
    </style>
</head>
<body>

<div class="header-buttons">
    <h1>The Blog</h1>
    <a href="http://localhost:8080/blog-1.0-SNAPSHOT/post" class="add-post-btn">
        Добавить пост
    </a>
</div>

<!-- Форма поиска по имени -->
<div class="search-form">
    <input type="text" id="postName" placeholder="Введите точное имя поста" />
    <button type="button" id="searchBtn">Найти</button>
    <button type="button" id="showAllBtn" style="display:none;">Показать посты</button>
</div>

<div id="searchInfo" class="search-info" style="display:none;"></div>

<!-- Контейнер для постов -->
<div class="posts-container" id="postsContainer">
    <!-- Посты будут динамически добавляться сюда -->
</div>

<script>
    let allPosts = []; // Сохраняем все посты для возможности вернуться
    let isSearchMode = false; // Флаг режима поиска

    const getPosts = async () => {
      try {
        const response = await fetch('http://localhost:8080/blog-1.0-SNAPSHOT/post/posts', {
          headers: {
            'Accept': 'application/json'
          }
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error('Ошибка при получении постов:', error);
        return [];
      }
    };

    // Функция для поиска поста по точному имени
    const searchPostByName = async (name) => {
      try {
        const response = await fetch(`http://localhost:8080/blog-1.0-SNAPSHOT/post/search?name=${encodeURIComponent(name)}`, {
          headers: {
            'Accept': 'application/json'
          }
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const posts = await response.json();
        return posts.length > 0 ? posts[0] : null; // Возвращаем первый найденный пост
      } catch (error) {
        console.error('Ошибка при поиске поста:', error);
        return null;
      }
    };

    function displayPosts(posts, searchQuery = '') {
      const container = document.getElementById('postsContainer');
      container.innerHTML = '';

      if (posts.length === 0) {
        container.innerHTML = '<div class="no-posts">Посты не найдены</div>';
        return;
      }

      // Отображаем информацию о поиске
      const searchInfo = document.getElementById('searchInfo');
      if (searchQuery) {
        searchInfo.style.display = 'block';
        searchInfo.textContent = `Результат поиска по запросу: "${searchQuery}"`;
      } else {
        searchInfo.style.display = 'none';
      }

      posts.forEach(post => {
        const postDiv = document.createElement('div');
        postDiv.className = 'post';

        // Заголовок поста
        const titleLink = document.createElement('a');
        titleLink.href = `http://localhost:8080/blog-1.0-SNAPSHOT/post/${post.id}`;
        titleLink.className = 'post-title';
        titleLink.textContent = post.name || 'Без названия';

        // Текст поста
        const contentDiv = document.createElement('div');
        contentDiv.className = 'post-text';
        contentDiv.textContent = post.text || '';

        // Изображение (если есть)
        if (post.image) {
          const img = document.createElement('img');
          img.src = `data:image/jpeg;base64,${post.image}`;
          img.alt = post.name || 'Изображение поста';
          postDiv.appendChild(img);
        }

        postDiv.appendChild(titleLink);
        postDiv.appendChild(contentDiv);
        container.appendChild(postDiv);
      });
    }

    // Обработчик кнопки поиска
    document.getElementById('searchBtn').addEventListener('click', async () => {
      const postName = document.getElementById('postName').value.trim();
      if (postName) {
        const foundPost = await searchPostByName(postName);

        if (foundPost) {
          // Отображаем только найденный пост
          displayPosts([foundPost], postName);
          isSearchMode = true;
          document.getElementById('showAllBtn').style.display = 'block';
        } else {
          displayPosts([], postName);
          document.getElementById('showAllBtn').style.display = 'block';
        }
      }
    });

    // Обработчик кнопки "Показать посты"
    document.getElementById('showAllBtn').addEventListener('click', () => {
      document.getElementById('postName').value = ''; // Очищаем поле поиска
      displayPosts(allPosts.slice(0, 3)); // Показываем первые 3 поста
      isSearchMode = false;
      document.getElementById('showAllBtn').style.display = 'none';
    });

    // Загрузка всех постов при открытии страницы
    (async () => {
      allPosts = await getPosts();
      displayPosts(allPosts.slice(0, 3)); // Показываем первые 3 поста
    })();
</script>
</body>
</html>